
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Monitor Server &#8212; Hat Core Documentation  documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Event Server" href="event/index.html" />
    <link rel="prev" title="Orchestrator" href="orchestrator.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="event/index.html" title="Event Server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="orchestrator.html" title="Orchestrator"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Hat Core Documentation  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Components</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="monitor-server">
<span id="monitor"></span><h1>Monitor Server<a class="headerlink" href="#monitor-server" title="Permalink to this headline">¶</a></h1>
<p>Monitor Server is component responsible for providing infrastructure necessary
for multiple redundant component execution. Additionally, Monitor Server
provides centralized registry of running components in single system which can
be used for service discovery.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Monitor Server functionality is defined under assumptions:</p>
<blockquote>
<div><ul class="simple">
<li><p>components running as part of single system are trusted and
implemented according to specifications</p></li>
<li><p>communication channels between components on single computing
node are reliable</p></li>
</ul>
</div></blockquote>
<p>Redundancy mechanisms provided by Monitor Server do not provide
reliability in case of possible component malfunctions due to
implementation errors.</p>
</div>
<div class="section" id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>By installing Monitor Server from <cite>hat-monitor</cite> package, executable
<cite>hat-monitor</cite> becomes available and can be used for starting this component.</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/opt/hostedtoolcache/Python/3.8.2/x64/lib/python3.8/runpy.py&quot;, line 193, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File &quot;/opt/hostedtoolcache/Python/3.8.2/x64/lib/python3.8/runpy.py&quot;, line 86, in _run_code
    exec(code, run_globals)
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/monitor/server/__main__.py&quot;, line 3, in &lt;module&gt;
    from hat.monitor.server.main import main
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/monitor/server/main.py&quot;, line 13, in &lt;module&gt;
    from hat.monitor import common
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/monitor/common.py&quot;, line 5, in &lt;module&gt;
    from hat import chatter
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/chatter.py&quot;, line 31, in &lt;module&gt;
    sbs_repo = sbs.Repository.from_json(Path(__file__).parent /
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/sbs/repository.py&quot;, line 86, in from_json
    data = json.decode_file(data)
  File &quot;/home/runner/work/hat-core/hat-core/src_py/hat/util/json.py&quot;, line 187, in decode_file
    with open(path, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/runner/work/hat-core/hat-core/src_py/hat/chatter_sbs_repo.json&#39;
</pre></div>
</div>
</div></blockquote>
<p>Additionally, <cite>hat-monitor</cite> package provides implementation of library which
can be used as basis for communication between components and Monitor Server.
This library is available in <code class="xref py py-mod docutils literal notranslate"><span class="pre">hat.monitor.client</span></code> module.</p>
</div>
<div class="section" id="communication-model">
<h2>Communication model<a class="headerlink" href="#communication-model" title="Permalink to this headline">¶</a></h2>
<p>Monitor Server provides n-node redundancy architecture based on
<a class="reference internal" href="../libraries/chatter.html#chatter"><span class="std std-ref">chatter</span></a> protocol (structure of communication messages is
defined in <cite>HatMonitor</cite> package). It is based on server-client communication
between components and monitor server. There also exists horizontal peer
communication between multiple monitor servers which enables forming of
single system based on multiple distributed computing nodes. It is assumed
that, for each system, single computing node runs single instance of Monitor
Server and unlimited number of components that connect to local Monitor Server.
Each node’s Monitor Server establishes communication with other nodes’ Monitor
Server through single master Monitor Server. Hierarchy of Monitor Servers
which can perform functionality of master is configured statically with
configuration options available to each Monitor Server on its startup.</p>
<p>Entities participating in communication between components and local monitor
server:</p>
<blockquote>
<div><ul>
<li><p>Client</p>
<blockquote>
<div><p>Component proclaiming its existence to the server, discovering
other components and participating in redundancy algorithm.</p>
</div></blockquote>
</li>
<li><p>Server</p>
<blockquote>
<div><p>Local monitor server providing global components state to all local
clients and providing user interface.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Entities participating in ‘horizontal’ communication between Monitor Servers:</p>
<blockquote>
<div><ul>
<li><p>Master</p>
<blockquote>
<div><p>Monitor Server responsible for execution of the redundancy algorithm
and notifying other Monitor Servers about the current global state of
the entire system.</p>
</div></blockquote>
</li>
<li><p>Slave</p>
<blockquote>
<div><p>Monitor Server responsible for notifying master about its current local
state and delegating master’s notifications to its server entity.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Monitor Server uses two different independent listening sockets for
client-server and master-slave communication.</p>
<p>If we represent components with <cite>Cn</cite> and Monitor Servers with <cite>Mn</cite>, where
master hierarchy of <cite>M1 &gt; … &gt; Mn</cite> is presumed, an example of a single system
monitor communication can be viewed as:</p>
<blockquote>
<div>graph {
    bgcolor=transparent;
    layout=neato;
    node [fontname=&quot;Arial&quot;];
    {
        node [shape=box];
        M1; M2; M3; M4;
    }
    {
        node [shape=oval];
        C1; C2; C3; C4; C5; C6; C7; C8; C9; C10; C11; C12;
    }
    {
        edge [dir=forward, style=bold, len=2];
        M2 -- M1;
        M3 -- M1;
        M4 -- M1;
    }
    {
        edge [dir=forward, style=&quot;bold,dashed&quot;, len=2];
        M3 -- M2;
        M4 -- M2;
        M4 -- M3;
    }
    {
        edge [dir=both, arrowsize=0.5];
        M1 -- C1;
        M1 -- C2;
        M1 -- C3;
        M2 -- C4;
        M2 -- C5;
        M2 -- C6;
        M3 -- C7;
        M3 -- C8;
        M3 -- C9;
        M4 -- C10;
        M4 -- C11;
        M4 -- C12;
    }
}</div></blockquote>
</div>
<div class="section" id="component-information">
<h2>Component information<a class="headerlink" href="#component-information" title="Permalink to this headline">¶</a></h2>
<p>Component information is basic structure of properties that describe each
component included in system. It is initially created on local Monitor Server
and later updated by master Monitor Server. Collection of all components
information associated with clients connected to local Monitor Server and
calculated by local Monitor Server is called local state. Collection of all
components information in single system calculated by master Monitor server is
called global state. Each Monitor Server provides global state to its local
clients.</p>
<p>Properties included in a component information:</p>
<blockquote>
<div><ul>
<li><p><cite>cid</cite></p>
<blockquote>
<div><p>Component id assigned to client by its local Monitor Server.</p>
</div></blockquote>
</li>
<li><p><cite>mid</cite></p>
<blockquote>
<div><p>Monitor id identifying local Monitor Server (assigned to local Monitor
Server by master). Value <code class="docutils literal notranslate"><span class="pre">0</span></code> indicates Monitor Server which is master
or is not connected to remote master.</p>
</div></blockquote>
</li>
<li><p><cite>name</cite></p>
<blockquote>
<div><p>User provided identifier of component. This entry is used only for
UI presentation purposes and logging but it is recommended to
use unique identifiers for each component instance. This property
is assigned by client.</p>
</div></blockquote>
</li>
<li><p><cite>group</cite></p>
<blockquote>
<div><p>String identifier by which components are grouped while blessing
calculation algorithm is applied (see <a class="reference internal" href="#blessing-algorithm">Blessing algorithm</a>). This
property is assigned by client.</p>
</div></blockquote>
</li>
<li><p><cite>address</cite></p>
<blockquote>
<div><p>Component’s address which other components use to connect to the
component. This property is optional and is assigned by client.</p>
</div></blockquote>
</li>
<li><p><cite>rank</cite></p>
<blockquote>
<div><p>Component’s rank - used by <a class="reference internal" href="#blessing-algorithm">Blessing algorithm</a>. This property is
initially assigned by local Monitor Server but can later be changed by
any Monitor Server.</p>
</div></blockquote>
</li>
<li><p><cite>blessing</cite></p>
<blockquote>
<div><p>Optional number used as unique token assigned and changed by master
Monitor Server (see <a class="reference internal" href="#component-lifetime">Component lifetime</a>).</p>
</div></blockquote>
</li>
<li><p><cite>ready</cite></p>
<blockquote>
<div><p>Optional number used as unique token assigned and changed by client
(see <a class="reference internal" href="#component-lifetime">Component lifetime</a>).</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="master-slave-communication">
<h2>Master slave communication<a class="headerlink" href="#master-slave-communication" title="Permalink to this headline">¶</a></h2>
<p>Horizontal communication between Monitor Servers is hierarchically ordered.
Each Monitor Server knows its superiors’ addresses. If <code class="docutils literal notranslate"><span class="pre">M1</span> <span class="pre">&gt;</span> <span class="pre">M2</span> <span class="pre">&gt;</span> <span class="pre">M3</span></code>,
then <code class="docutils literal notranslate"><span class="pre">M1</span></code> doesn’t know any other monitor address; <code class="docutils literal notranslate"><span class="pre">M2</span></code> knows the address
of <code class="docutils literal notranslate"><span class="pre">M1</span></code>; <code class="docutils literal notranslate"><span class="pre">M3</span></code> knows addresses of <code class="docutils literal notranslate"><span class="pre">M1</span></code> and <code class="docutils literal notranslate"><span class="pre">M2</span></code> in that order.</p>
<p>Each Monitor Server’s configuration contains zero or more other Monitor
Server addresses. These other servers are “superior” to the monitor server. A
monitor server will always try to maintain an active connection with exactly
one of its superiors. The addresses list is ordered by priority meaning that if
the Monitor Server isn’t connected to a superior, it tries to connect to the
first monitor server in the list. If the connection fails, it tries the second
one and so on. If it can’t connect to any of its superiors, it can proclaim
itself as master. The connecting to master process should continue even if the
Monitor Server is master or it is not connected to its first superior. The
connecting loop should be executed at least 2 or 3 times before the timeout can
be used. The timeout should be kept small.</p>
<p>Once a slave Monitor Server connects to the Master Monitor server it sends its
local state to the master and keeps notifying the master about any change in
its local state while the connection is active. The master gathers all local
states and generates its global state which it then transmits to all its
slaves and keeps notifying them of any change. Master also identifies each
Monitor Server with unique monitor identifier (<cite>mid</cite>) which is provided to
slave together with global state. It is important to note that only master
Monitor Server calculates blessing token state for each component.</p>
<p>Every Monitor Server is responsible for starting master listening socket
immediately after startup. While Monitor Server isn’t operating in master mode,
all connections made to master listening socket will be closed immediately
after their establishment - this behavior will indicate to connecting Monitor
Server that its superior is not currently master.</p>
<p>Messages used in master slave communications are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 14%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Message</p></th>
<th class="head" colspan="3"><p>Conversation</p></th>
<th class="head" rowspan="2"><p>Direction</p></th>
</tr>
<tr class="row-even"><th class="head"><p>First</p></th>
<th class="head"><p>Last</p></th>
<th class="head"><p>Token</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>MsgSlave</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>s &gt; m</p></td>
</tr>
<tr class="row-even"><td><p>MsgMaster</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>m &gt; s</p></td>
</tr>
<tr class="row-odd"><td><p>MsgSetRank</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>s &gt; m</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>where <cite>s</cite> &gt; <cite>m</cite> represents slave to master communication and <cite>m</cite> &gt; <cite>s</cite>
represents master to slave communication. When new connection is established,
master should immediately associate new <cite>mid</cite> with connection and send
<cite>MsgMaster</cite>. After slave receives this initial <cite>MsgMaster</cite>, it should send
<cite>MsgSlave</cite> with local state updated with newly received <cite>mid</cite>. Each
communicating entity (master or slave) should send new state message
(<cite>MsgMaster</cite> or <cite>MsgSlave</cite>) if any data obtained from <cite>MsgSlave</cite> or <cite>MsgMaster</cite>
changes. Sending of <cite>MsgMaster</cite> and <cite>MsgSlave</cite> should be implemented
independent of receiving messages from associated entity. Implementation
of master should not be dependent on receiving initial <cite>MsgSlave</cite> and should
continue sending <cite>MsgMaster</cite> on every state change even if no <cite>MsgSlave</cite> is
received.</p>
</div>
<div class="section" id="server-client-communication">
<h2>Server client communication<a class="headerlink" href="#server-client-communication" title="Permalink to this headline">¶</a></h2>
<p>Vertical communication between client and server enables bidirectional
asynchronous exchange of component information data. Client is responsible
for providing <cite>name</cite>, <cite>group</cite>, <cite>address</cite> and <cite>ready</cite> properties initially and
on every change. Server provides global state to each connected client and
each client’s component id (<cite>cid</cite>) and monitor id (<cite>mid</cite>). If any part of
state available to server changes (including token changes), server sends
updated state to all clients. Client can also request change for information
provided to server at any time.</p>
<p>Messages used in server client communications are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 14%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Message</p></th>
<th class="head" colspan="3"><p>Conversation</p></th>
<th class="head" rowspan="2"><p>Direction</p></th>
</tr>
<tr class="row-even"><th class="head"><p>First</p></th>
<th class="head"><p>Last</p></th>
<th class="head"><p>Token</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>MsgClient</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>c &gt; s</p></td>
</tr>
<tr class="row-even"><td><p>MsgServer</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>T</p></td>
<td><p>s &gt; c</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>where <cite>c</cite> &gt; <cite>s</cite> represents client to server communication and <cite>s</cite> &gt;
<cite>c</cite> represents server to client communication. When new connection is
established, each communicating entity (server or client) server immediately
sends initial state message (<cite>MsgServer</cite> or <cite>MsgClient</cite>) and should send new
state messages when any data obtained from <cite>MsgServer</cite> or <cite>MsgClient</cite> changes.
Sending of <cite>MsgServer</cite> and <cite>MsgClient</cite> should be implemented independent of
receiving messages from associated entity. Implementation of server should not
be dependent on receiving initial <cite>MsgClient</cite> and should continue sending
<cite>MsgServer</cite> on every state change even if no <cite>MsgClient</cite> is received.</p>
</div>
<div class="section" id="component-lifetime">
<h2>Component lifetime<a class="headerlink" href="#component-lifetime" title="Permalink to this headline">¶</a></h2>
<p>For most components, connection to local Monitor Server is mandatory for
providing implemented functionality. Because of this, component usually connects
to local Monitor Server during startup and preserves this active connection
during entire component run lifetime. If this connection is closed for any
reason, process also terminates. This behavior is not mandated.</p>
<p>Components which connect to Monitor Server participate in redundancy
supervised by master Monitor Server. Redundancy utilizes two tokens:</p>
<blockquote>
<div><ul>
<li><p><cite>blessing</cite> token</p>
<blockquote>
<div><p>This token is controlled exclusively by master Monitor Server. If
connection to master is not established, token’s value is not set.</p>
</div></blockquote>
</li>
<li><p><cite>ready</cite> token</p>
<blockquote>
<div><p>This token is controlled exclusively by client. It will match
<cite>blessing</cite> value only if component is ready to provide its primary
functionality. At any time, if component stops providing primary
functionality, it should revoke this token.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Each component determines if it should provide primary functionality based on
global state provided by local Monitor Server. If client’s component
information contains <cite>blessing</cite> and <cite>ready</cite> token with same value, component
can provide primary functionality. If, at any time, these values do not match,
component should stop its usual activity which is indicated by client’s
revoking of <cite>ready</cite> flag.</p>
</div>
<div class="section" id="blessing-algorithm">
<h2>Blessing algorithm<a class="headerlink" href="#blessing-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Blessing algorithm determines value of each component’s <cite>blessing</cite> token. This
calculation is performed on master Monitor Server and should be executed
each time any part of global state changes. This calculation should be
integrated part of state change and thus provide global state consistency.</p>
<p>Monitor Server implements multiple algorithms for calculating value of blessing
token. Each component <cite>group</cite> can have different associated blessing algorithm
and all groups that don’t have associated blessing algorithm use default
algorithm. Group’s associated algorithms and default algorithm are provided
to Monitor Server as configuration parameters during its startup.</p>
<p>Calculation of <cite>blessing</cite> token values is based only on previous global state
and new changes that triggered execution of blessing algorithm.</p>
<p>Currently supported algorithms:</p>
<blockquote>
<div><ul>
<li><p>BLESS_ALL</p>
<blockquote>
<div><p>This simple algorithm provides continuous blessing to all components
in associated group. Blessing is never revoked.</p>
</div></blockquote>
</li>
<li><p>BLESS_ONE</p>
<blockquote>
<div><p>In each group with this algorithm associated, there can be only one
highlander and component with issued blessing token. For determining
which component can receive blessing token, component’s rank is used.
Components with mathematically lower rank value have higher priority
in obtaining blessing token. If there exist more than one component with
highest priority than one with already set blessing token is chosen.
If neither of component have already set blessing token, than one of
components with lowest <cite>mid</cite> value is chosen. Once component which can
obtain blessing token is chosen, if chosen component doesn’t already
have blessing token, master revokes previously issued blessing token
from other component in the same group and waits for all components in
the same group to revoke theirs ready tokens. Only once all other
components revoke their ready tokens, master issues new blessing token
to chosen component.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="components-rank">
<h2>Components rank<a class="headerlink" href="#components-rank" title="Permalink to this headline">¶</a></h2>
<p>Association of component’s rank is initial responsibility of component’s
local Monitor Server. Each Monitor Server should associate same rank as was
last rank value associated with previously active client connection with
same <cite>name</cite> and <cite>group</cite> values as newly established connection. If such
previously active connection does not exist, default rank value, as specified
by Monitor Server’s configuration, is applied. After initial rank value is
associated with client and its <cite>ComponentInfo</cite>, all Monitor Servers can
request change of rank for all <cite>ComponentInfo</cite> s. These changes should be
monitored and cached by local Monitor Servers in case connection to component
is lost and same component tries to establish new connection. This cache is
maintained for duration of single Monitor Server process execution and is not
persisted between different Monitor Server processes.</p>
</div>
<div class="section" id="user-interface">
<h2>User interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<p>As secondary functionality, Monitor Server provides web-based user interface
for monitoring global components state and controlling component’s rank.
Implementation of this functionality is split into server-side web backend and
web frontend exchanging communication messages based on
<a class="reference internal" href="../libraries/juggler.html#juggler"><span class="std std-ref">juggler</span></a> communication protocol.</p>
<div class="section" id="backend-to-frontend-communication">
<h3>Backend to frontend communication<a class="headerlink" href="#backend-to-frontend-communication" title="Permalink to this headline">¶</a></h3>
<p>Backend provides to frontends all information that is made available by server
to clients. When this information changes, all frontends are notified of
this change. Current state of <cite>mid</cite> and all components is set and continuously
updated as part of server’s juggler local data.</p>
<p>After new Juggler connection is established, backend will immediately set
juggler local data defined by JSON schema:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;$schema&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://json-schema.org/schema#&quot;</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="nt">required</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mid</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">components</span>
<span class="nt">properties</span><span class="p">:</span>
    <span class="nt">mid</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
    <span class="nt">components</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
        <span class="nt">items</span><span class="p">:</span>
            <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
            <span class="nt">required</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cid</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mid</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">group</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">address</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rank</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">blessing</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ready</span>
            <span class="nt">properties</span><span class="p">:</span>
                <span class="nt">cid</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                <span class="nt">mid</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                <span class="nt">name</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                <span class="nt">group</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                <span class="nt">address</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                        <span class="p p-Indicator">-</span> <span class="s">&quot;null&quot;</span>
                <span class="nt">rank</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                <span class="nt">blessing</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                        <span class="p p-Indicator">-</span> <span class="s">&quot;null&quot;</span>
                <span class="nt">ready</span><span class="p">:</span>
                    <span class="nt">type</span><span class="p">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                        <span class="p p-Indicator">-</span> <span class="s">&quot;null&quot;</span>
</pre></div>
</div>
<p>Server doesn’t send additional <cite>MESSAGE</cite> juggler messages.</p>
</div>
<div class="section" id="frontend-to-backend-communication">
<h3>Frontend to backend communication<a class="headerlink" href="#frontend-to-backend-communication" title="Permalink to this headline">¶</a></h3>
<p>This communication is used primary for enabling user control of components’
ranks. At any time, frontend can send <cite>set_rank</cite> message to backend requesting
change of rank for any available component (event those that are not local to
backend’s Monitor Server). These massages are transmitted as juggler’s
<cite>MESSAGE</cite> messages defined by JSON schema:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;$schema&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;http://json-schema.org/schema#&quot;</span>
<span class="nt">oneOf</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;$ref&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;#/definitions/set_rank&quot;</span>
<span class="nt">definitions</span><span class="p">:</span>
    <span class="nt">set_rank</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
        <span class="nt">required</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">payload</span>
        <span class="nt">properties</span><span class="p">:</span>
            <span class="nt">type</span><span class="p">:</span>
                <span class="nt">enum</span><span class="p">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">set_rank</span>
            <span class="nt">payload</span><span class="p">:</span>
                <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
                <span class="nt">required</span><span class="p">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cid</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mid</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rank</span>
                <span class="nt">properties</span><span class="p">:</span>
                    <span class="nt">cid</span><span class="p">:</span>
                        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                    <span class="nt">mid</span><span class="p">:</span>
                        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                    <span class="nt">rank</span><span class="p">:</span>
                        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</div>
<p>Client’s juggler local data isn’t changed during communication with server (it
remains <cite>null</cite>).</p>
</div>
</div>
<div class="section" id="future-features">
<h2>Future features<a class="headerlink" href="#future-features" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<ul>
<li><p>configurable master retry count and timeouts</p></li>
<li><p>optional connection to monitor/event server</p>
<blockquote>
<div><ul class="simple">
<li><p>mapping of current status to events</p></li>
<li><p>listening for control events</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="python-implementation">
<h2>Python implementation<a class="headerlink" href="#python-implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="common">
<h3>Common<a class="headerlink" href="#common" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="client">
<h3>Client<a class="headerlink" href="#client" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-hat.monitor.server.blessing">
<span id="blessing"></span><h3>Blessing<a class="headerlink" href="#module-hat.monitor.server.blessing" title="Permalink to this headline">¶</a></h3>
<p>Implementation of blessing calculation algorithms</p>
<dl class="py class">
<dt id="hat.monitor.server.blessing.Algorithm">
<em class="property">class </em><code class="sig-prename descclassname">hat.monitor.server.blessing.</code><code class="sig-name descname">Algorithm</code><a class="headerlink" href="#hat.monitor.server.blessing.Algorithm" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>An enumeration.</p>
<ul class="simple">
<li><p>BLESS_ALL</p></li>
<li><p>BLESS_ONE</p></li>
</ul>
<dl class="py attribute">
<dt id="hat.monitor.server.blessing.Algorithm.BLESS_ALL">
<code class="sig-name descname">BLESS_ALL</code><em class="property"> = 1</em><a class="headerlink" href="#hat.monitor.server.blessing.Algorithm.BLESS_ALL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="hat.monitor.server.blessing.Algorithm.BLESS_ONE">
<code class="sig-name descname">BLESS_ONE</code><em class="property"> = 2</em><a class="headerlink" href="#hat.monitor.server.blessing.Algorithm.BLESS_ONE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="hat.monitor.server.blessing.calculate_blessing">
<code class="sig-prename descclassname">hat.monitor.server.blessing.</code><code class="sig-name descname">calculate_blessing</code><span class="sig-paren">(</span><em class="sig-param">group_algorithms</em>, <em class="sig-param">components</em>, <em class="sig-param">default_algorithm=&lt;Algorithm.BLESS_ONE: 2&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#hat.monitor.server.blessing.calculate_blessing" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate blessing</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>group_algorithms</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><a class="reference internal" href="#hat.monitor.server.blessing.Algorithm" title="hat.monitor.server.blessing.Algorithm"><em>Algorithm</em></a><em>]</em>) – association of algorith to group</p></li>
<li><p><strong>components</strong> (<em>List</em><em>[</em><em>common.ComponentInfo</em><em>]</em>) – components state with previous blessing tokens</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>components state with updated blessing</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[common.ComponentInfo]</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="server">
<h3>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="master">
<h3>Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-hat.monitor.server.ui">
<span id="ui"></span><h3>UI<a class="headerlink" href="#module-hat.monitor.server.ui" title="Permalink to this headline">¶</a></h3>
<p>Implementation of web server UI</p>
<dl class="py attribute">
<dt id="hat.monitor.server.ui.mlog">
<code class="sig-prename descclassname">hat.monitor.server.ui.</code><code class="sig-name descname">mlog</code><a class="headerlink" href="#hat.monitor.server.ui.mlog" title="Permalink to this definition">¶</a></dt>
<dd><p>module logger</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>logging.Logger</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="hat.monitor.server.ui.create">
<em class="property">async </em><code class="sig-prename descclassname">hat.monitor.server.ui.</code><code class="sig-name descname">create</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">conf</span></em>, <em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">server</span></em><span class="sig-paren">)</span><a class="headerlink" href="#hat.monitor.server.ui.create" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>COROUTINE</strong>
Create user interface</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conf</strong> (<em>hat.json.Data</em>) – configuration defined by
<code class="docutils literal notranslate"><span class="pre">hat://monitor/main.yaml#/definitions/ui</span></code></p></li>
<li><p><strong>path</strong> (<em>pathlib.Path</em>) – web ui directory path</p></li>
<li><p><strong>server</strong> (<em>hat.monitor.server.Server</em>) – local monitor server</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>WebServer</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="hat.monitor.server.ui.WebServer">
<em class="property">class </em><code class="sig-prename descclassname">hat.monitor.server.ui.</code><code class="sig-name descname">WebServer</code><a class="headerlink" href="#hat.monitor.server.ui.WebServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Web server UI</p>
<p>For creating new instance of this class see <a class="reference internal" href="#hat.monitor.server.ui.create" title="hat.monitor.server.ui.create"><code class="xref py py-func docutils literal notranslate"><span class="pre">create()</span></code></a></p>
<dl class="py method">
<dt id="hat.monitor.server.ui.WebServer.closed">
<em class="property">property </em><code class="sig-name descname">closed</code><a class="headerlink" href="#hat.monitor.server.ui.WebServer.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>closed future</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>asyncio.Future</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="hat.monitor.server.ui.WebServer.async_close">
<em class="property">async </em><code class="sig-name descname">async_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hat.monitor.server.ui.WebServer.async_close" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>COROUTINE</strong>
Close web server and all active connections</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="translator.html">Translator</a></li>
<li class="toctree-l2"><a class="reference internal" href="orchestrator.html">Orchestrator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Monitor Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="event/index.html">Event Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="gateway/index.html">Gateway</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui/index.html">GUI Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="orchestrator.html"
                        title="previous chapter">Orchestrator</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="event/index.html"
                        title="next chapter">Event Server</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="event/index.html" title="Event Server"
             >next</a> |</li>
        <li class="right" >
          <a href="orchestrator.html" title="Orchestrator"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Hat Core Documentation  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Components</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Hat Open AUTHORS.
    </div>
  </body>
</html>